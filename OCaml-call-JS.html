<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>OCaml call JS | Why JavaScript?</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="gitbook/style.css">
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="./Runtime-representation.html" />
    
    
    <link rel="prev" href="./JS-call-OCaml.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="5.3"
        data-chapter-title="OCaml call JS"
        data-filepath="OCaml-call-JS.md"
        data-basepath="."
        data-revision="Wed May 25 2016 15:05:18 GMT-0400 (EDT)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Home
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" >
            
                
                    <a target="_blank" href="https:/bloomberg.github.io/bucklescript/js-demo">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Playground
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2" >
            
            <span><b>2.</b> Get Started</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="Installation.html">
            
                
                    <a href="./Installation.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Installation
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="Create-a-simple-example-with-NPM.html">
            
                
                    <a href="./Create-a-simple-example-with-NPM.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Create a simple example with NPM
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="NPM-Support.html">
            
                
                    <a href="./NPM-Support.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        NPM Support
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" >
            
            <span><b>3.</b> BuckleScript Basics</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="FAQ.html">
            
                
                    <a href="./FAQ.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        FAQ
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" >
            
                
                    <a target="_blank" href="https:/ocaml.org/">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        About OCaml
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="Compiler-options.html">
            
                
                    <a href="./Compiler-options.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        Compiler options
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="How-to-adapt-your-build-system.html">
            
                
                    <a href="./How-to-adapt-your-build-system.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                        How to adapt your build system
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="Semantic-differences-from-other-backends.html">
            
                
                    <a href="./Semantic-differences-from-other-backends.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.</b>
                        
                        Semantic differences from other backends
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="JavaScript-target-versions.html">
            
                
                    <a href="./JavaScript-target-versions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.6.</b>
                        
                        JavaScript target versions
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" >
            
            <span><b>4.</b> BuckleScript Overview</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="Compiler-overview.html">
            
                
                    <a href="./Compiler-overview.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        Compiler overview
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" >
            
            <span><b>5.</b> BuckleScript FFI</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="Curry-and-Uncurry-functions.html">
            
                
                    <a href="./Curry-and-Uncurry-functions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        Curry and Uncurry functions
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="JS-call-OCaml.html">
            
                
                    <a href="./JS-call-OCaml.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        JS call OCaml
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="5.3" data-path="OCaml-call-JS.html">
            
                
                    <a href="./OCaml-call-JS.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.3.</b>
                        
                        OCaml call JS
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="Runtime-representation.html">
            
                
                    <a href="./Runtime-representation.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.4.</b>
                        
                        Runtime representation
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="Experimental-support-of-typescript.html">
            
                
                    <a href="./Experimental-support-of-typescript.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.5.</b>
                        
                        Experimental support of typescript
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="Unsupported-IO-primitives.html">
            
                
                    <a href="./Unsupported-IO-primitives.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.6.</b>
                        
                        Unsupported IO primitives
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6" >
            
            <span><b>6.</b> Contributions</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" >
            
                
                    <a target="_blank" href="https:/github.com/bloomberg/bucklescript">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        Github Link
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="Dev-mode-How-to.html">
            
                
                    <a href="./Dev-mode-How-to.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.2.</b>
                        
                        Dev mode How to
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="Help-move-runtime-functions-from-OCaml-to-Javascript.html">
            
                
                    <a href="./Help-move-runtime-functions-from-OCaml-to-Javascript.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.3.</b>
                        
                        Help move runtime functions from OCaml to Javascript
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7" >
            
            <span><b>7.</b> Roadmap</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1" data-path="Roadmap.html">
            
                
                    <a href="./Roadmap.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.1.</b>
                        
                        Roadmap
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="8" >
            
            <span><b>8.</b> Comparisons</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1" data-path="Differences-from-js_of_ocaml.html">
            
                
                    <a href="./Differences-from-js_of_ocaml.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.1.</b>
                        
                        Differences from js_of_ocaml
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >Why JavaScript?</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <p>To make OCaml work smoothly with Javascript, we introduced several
extensions to OCaml language. Those BuckleScript extensions
facilitates the integration of native JavaScript code as well as
improve the generated code.</p>
<blockquote>
<p>Note that all those extension will be correctly ignored by the native OCaml compiler.</p>
</blockquote>
<h2 id="embedding-raw-javascript-code">Embedding raw Javascript code</h2>
<ul>
<li><p>extension <code>bs.raw</code></p>
<p> It can be either <code>[%bs.raw{|  this_is_arbitrary_js_expression |}]</code> or <code>[%%bs.raw{| this is arbitrary_js_statement |}</code></p>
<p> Use cases:
 for example if you want to use a JavaScript string, you can write code like this</p>
<pre><code class="lang-OCaml"> <span class="hljs-keyword">let</span> x  : <span class="hljs-built_in">string</span> = [%bs.raw{|<span class="hljs-string">&quot;\x01\x02&quot;</span>|}]
</code></pre>
<p> which will be compiled into </p>
<pre><code class="lang-js"> <span class="hljs-keyword">var</span> x = <span class="hljs-string">&quot;\x01\x02&quot;</span>
</code></pre>
<pre><code class="lang-OCaml"> [%%bs.raw{|
 // Math.imul polyfill
 if (!Math.imul){
     Math.imul = function (..) {..}
  }
 |}]
</code></pre>
<p> In the expression level, i.e, <code>[%bs.raw ...]</code> user can add a type
 annotation, for example:</p>
<pre><code class="lang-ocaml"> <span class="hljs-keyword">let</span> f : <span class="hljs-built_in">float</span> * <span class="hljs-built_in">float</span> -&gt; <span class="hljs-built_in">float</span> [@uncurry] = [%bs.raw <span class="hljs-string">&quot;Math.max&quot;</span> ]
 <span class="hljs-keyword">in</span> f (<span class="hljs-number">3.0</span>, <span class="hljs-number">2.0</span>) [@uncurry]
</code></pre>
<p> will be translated into </p>
<pre><code class="lang-js"> <span class="hljs-keyword">var</span> f = <span class="hljs-built_in">Math</span>.max ;
 f(<span class="hljs-number">3.0</span>,<span class="hljs-number">2.0</span>)
</code></pre>
<p> Caveat:</p>
<ol>
<li>So far we don&apos;t do any sanity check in the quoted text (syntax check is a long-term goal)</li>
<li>You should not refer symbols in OCaml code, it is not guaranteed that the order is correct.
You should avoid introducing new symbols in the raw code, if needed, use the <code>$$</code> prefix (ie <code>$$your_func_name</code>) </li>
</ol>
</li>
</ul>
<h2 id="debugger-support">Debugger support</h2>
<ul>
<li><p>extension <code>bs.debugger</code></p>
<p> It can be <code>[%bs.debugger]</code></p>
<p> use case</p>
<pre><code class="lang-ocaml"> <span class="hljs-keyword">let</span> f x y = 
    [%bs.debugger];
    x + y
</code></pre>
<p> which will be compiled into </p>
<pre><code class="lang-js"> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">f</span> (<span class="hljs-params">x,y</span>) </span>{
   <span class="hljs-keyword">debugger</span>; <span class="hljs-comment">// JavaScript developer tools will set an breakpoint and stop here</span>
   x + y;
 }
</code></pre>
</li>
</ul>
<h2 id="ffi-to-js-functions">FFI to js functions</h2>
<p>This part is similar to <a href="http://caml.inria.fr/pub/docs/manual-ocaml-4.02/intfc.html" target="_blank">traditional FFI</a>, 
syntax is described as below:</p>
<pre><code class="lang-OCaml"><span class="hljs-keyword">external</span> <span class="hljs-keyword">value</span>-name :  typexpr =  <span class="hljs-keyword">external</span>-declaration  attributes
<span class="hljs-keyword">external</span>-declaration :=     <span class="hljs-built_in">string</span>-literal
</code></pre>
<p>Users need declare types of the foreign function (JS function here) and 
gives it a type and customized attributes</p>
<h3 id="attributes">attributes</h3>
<ul>
<li><p><code>bs.call</code></p>
<p>Example </p>
<pre><code class="lang-ocaml"><span class="hljs-keyword">external</span> imul : <span class="hljs-built_in">int</span> -&gt; <span class="hljs-built_in">int</span> -&gt; <span class="hljs-built_in">int</span> = <span class="hljs-string">&quot;Math.imul&quot;</span> [@@bs.call]
</code></pre>
<blockquote>
<p>Note that if you want to make a single FFI for both c functions and JavaScript functions, you can 
give JavaScript foreign function different name</p>
</blockquote>
<pre><code class="lang-ocaml"><span class="hljs-keyword">external</span> imul : <span class="hljs-built_in">int</span> -&gt; <span class="hljs-built_in">int</span> -&gt; <span class="hljs-built_in">int</span> = <span class="hljs-string">&quot;c_imul&quot;</span> [@@bs.call <span class="hljs-string">&quot;Math.imul&quot;</span>]
</code></pre>
</li>
<li><p><code>bs.new</code></p>
<p>This attribute is to help user create a JavaScript object
example:</p>
<pre><code class="lang-ocaml"><span class="hljs-keyword">external</span> create_date : <span class="hljs-built_in">unit</span> -&gt; t = <span class="hljs-string">&quot;Date&quot;</span> [@@bs.<span class="hljs-keyword">new</span>]
</code></pre>
</li>
<li><p><code>bs.val</code> </p>
<p> Bind to a JavaScript value</p>
<pre><code class="lang-OCaml"> <span class="hljs-keyword">type</span> dom 
    <span class="hljs-comment">(* Abstract type for the DOM *)</span>

 <span class="hljs-keyword">external</span> dom : dome = <span class="hljs-string">&quot;document&quot;</span> [@@bs.<span class="hljs-keyword">val</span>]
</code></pre>
</li>
<li><p><code>bs.send</code></p>
<p>This attribute is to help user send a message to js object</p>
<pre><code class="lang-OCaml"><span class="hljs-keyword">type</span> id 
  <span class="hljs-comment">(** Abstract type for id object *)</span>
<span class="hljs-keyword">external</span> get_by_id : dom -&gt; <span class="hljs-built_in">string</span> -&gt; id = <span class="hljs-string">&quot;getElementById&quot;</span> [@@bs.send]
</code></pre>
<p>The object is always the first argument and arguments follow.</p>
<pre><code class="lang-OCaml">getElementById dom <span class="hljs-string">&quot;xx&quot;</span>
</code></pre>
<p>will be compiled as </p>
<pre><code class="lang-js">dom.getElementById(<span class="hljs-string">&quot;xx&quot;</span>)
</code></pre>
</li>
<li><p><code>bs.get</code>, <code>bs.set</code>
This attribute help get and set the property of a JavaScript object.</p>
<pre><code class="lang-OCaml"><span class="hljs-keyword">type</span> textarea
<span class="hljs-keyword">external</span> set_name : textarea -&gt; <span class="hljs-built_in">string</span> -&gt; <span class="hljs-built_in">unit</span> = <span class="hljs-string">&quot;name&quot;</span> [@@bs.set]
<span class="hljs-keyword">external</span> get_name : textarea -&gt; <span class="hljs-built_in">string</span> = <span class="hljs-string">&quot;name&quot;</span> [@@bs.get]
</code></pre>
</li>
<li><p><code>bs.set_index</code> <code>bs.get_index</code></p>
<p>This attribute help dynamic access to JavaScript property</p>
<pre><code class="lang-OCaml"><span class="hljs-keyword">module</span> <span class="hljs-type">Int32Array</span> = <span class="hljs-keyword">struct</span>
  <span class="hljs-keyword">type</span> t
  <span class="hljs-keyword">external</span> create : <span class="hljs-built_in">int</span> -&gt; t = <span class="hljs-string">&quot;Int32Array&quot;</span> [@@bs.<span class="hljs-keyword">new</span>]
  <span class="hljs-keyword">external</span> get : t -&gt; <span class="hljs-built_in">int</span> -&gt; <span class="hljs-built_in">int</span> = <span class="hljs-string">&quot;&quot;</span> [@@bs.get_index]
  <span class="hljs-keyword">external</span> set : t -&gt; <span class="hljs-built_in">int</span> -&gt; <span class="hljs-built_in">int</span> -&gt; <span class="hljs-built_in">unit</span> = <span class="hljs-string">&quot;&quot;</span> [@@bs.set_index]
<span class="hljs-keyword">end</span>
</code></pre>
</li>
</ul>
<ul>
<li><p><code>bs.module</code></p>
<p> Qualify the JavaScript value by a module name</p>
<pre><code class="lang-OCaml"> <span class="hljs-keyword">external</span> add : <span class="hljs-built_in">int</span> -&gt; <span class="hljs-built_in">int</span> -&gt; <span class="hljs-built_in">int</span> = <span class="hljs-string">&quot;add&quot;</span> [@@bs.call] [@@bs.<span class="hljs-keyword">module</span> <span class="hljs-string">&quot;x&quot;</span>]
 <span class="hljs-keyword">let</span> f = add <span class="hljs-number">3</span> <span class="hljs-number">4</span>
</code></pre>
<p> will be compiled as </p>
<pre><code class="lang-js"> <span class="hljs-keyword">var</span> X = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;x&quot;</span>)
 <span class="hljs-keyword">var</span> f = X.add(<span class="hljs-number">3</span>,<span class="hljs-number">4</span>)
</code></pre>
<pre><code class="lang-OCaml"> <span class="hljs-keyword">external</span> add : <span class="hljs-built_in">int</span> -&gt; <span class="hljs-built_in">int</span> -&gt; <span class="hljs-built_in">int</span> = <span class="hljs-string">&quot;add&quot;</span> [@@bs.call] [@@bs.<span class="hljs-keyword">module</span> <span class="hljs-string">&quot;x&quot;</span> <span class="hljs-string">&quot;U&quot;</span>]
 <span class="hljs-keyword">let</span> f = add <span class="hljs-number">3</span> <span class="hljs-number">4</span>
</code></pre>
<p> Will be compiled as</p>
<pre><code class="lang-js"> <span class="hljs-keyword">var</span> U = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;x&quot;</span>)
 <span class="hljs-keyword">var</span> f = U.add(<span class="hljs-number">3</span>,<span class="hljs-number">4</span>)
</code></pre>
</li>
</ul>
<h2 id="a-simple-example-binding-to-mocha-unit-test-library">A simple example: binding to mocha unit test library</h2>
<p>   If we want to provide bindings to the <a href="https://mochajs.org/" target="_blank">mochajs</a> unit test framework, 
   below is an example</p>
<pre><code class="lang-OCaml">   <span class="hljs-keyword">external</span> describe : <span class="hljs-built_in">string</span> -&gt; (<span class="hljs-built_in">unit</span> -&gt; <span class="hljs-built_in">unit</span> [@uncurry]) -&gt; <span class="hljs-built_in">unit</span> = <span class="hljs-string">&quot;describe&quot;</span> [@@bs.call]
   <span class="hljs-keyword">external</span> it : <span class="hljs-built_in">string</span> -&gt; (<span class="hljs-built_in">unit</span> -&gt; <span class="hljs-built_in">unit</span> [@uncurry]) -&gt; <span class="hljs-built_in">unit</span> = <span class="hljs-string">&quot;it&quot;</span> [@@bs.call <span class="hljs-string">&quot;it&quot;</span>]
</code></pre>
<p>   Since, <code>mochajs</code> is a test framework, we also need some assertion
   test, we can also describe the bindings to <code>assert.deepEqual</code> from
   nodejs <code>assert</code> library:</p>
<pre><code class="lang-ocaml">   <span class="hljs-keyword">external</span> eq : <span class="hljs-symbol">&apos;a</span> -&gt; <span class="hljs-symbol">&apos;a</span> -&gt; <span class="hljs-built_in">unit</span> = <span class="hljs-string">&quot;deepEqual&quot;</span>  [@@bs.call] [@@bs.<span class="hljs-keyword">module</span> <span class="hljs-string">&quot;assert&quot;</span>]
</code></pre>
<p>On top of this we can write normal OCaml functions, for example:</p>
<pre><code class="lang-OCaml">   <span class="hljs-keyword">let</span> assert_equal = eq
   <span class="hljs-keyword">let</span> from_suites name suite  = 
       describe name (<span class="hljs-keyword">fun</span> [@uncurry] <span class="hljs-literal">()</span> -&gt; 
         <span class="hljs-type">List</span>.iter (<span class="hljs-keyword">fun</span> (name, code) -&gt; it name code) suite)
</code></pre>
<p>   The compiler would generate code as below:</p>
<pre><code class="lang-js">   <span class="hljs-keyword">var</span> Assert = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;assert&quot;</span>);
   <span class="hljs-keyword">var</span> List = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;../stdlib/list&quot;</span>);

   <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assert_equal</span>(<span class="hljs-params">prim, prim$1</span>) </span>{
     <span class="hljs-keyword">return</span> Assert.deepEqual(prim, prim$<span class="hljs-number">1</span>);
   }

   <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">from_suites</span>(<span class="hljs-params">name, suite</span>) </span>{
      <span class="hljs-keyword">return</span> describe(name, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
              <span class="hljs-keyword">return</span> List.iter(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">param</span>) </span>{
                          <span class="hljs-keyword">return</span> it(param[<span class="hljs-number">0</span>], param[<span class="hljs-number">1</span>]);
                        }, suite);
            });
    }
</code></pre>
<h2 id="ffi-to-object">FFI to object</h2>
<ul>
<li>Js object calling 
All JS object of type <code>a</code> are lifted to type <code>a Js.t</code> to avoid
conflict with OCaml&apos;s own object system. <code>##</code> is used in JS&apos;s object
method dispatch, while <code>#</code> is used in OCaml&apos;s object method dispatch.</li>
</ul>
<p>For example</p>
<pre><code class="lang-ocaml"><span class="hljs-keyword">let</span> f x a b = x ## hi (a,b)
</code></pre>
<p>is inferred as type</p>
<pre><code class="lang-ocaml"><span class="hljs-keyword">val</span> f : &lt; hi : (<span class="hljs-symbol">&apos;a</span> * <span class="hljs-symbol">&apos;b</span> -&gt; <span class="hljs-symbol">&apos;c</span> [@uncurry] ;  .. &gt; <span class="hljs-type">Js</span>.t  -&gt; <span class="hljs-symbol">&apos;a</span> -&gt; <span class="hljs-symbol">&apos;b</span> -&gt; <span class="hljs-symbol">&apos;c</span>
</code></pre>
<ul>
<li><p><code>bs.obj</code></p>
<p>This attribute helps create JavaScript object literal</p>
</li>
</ul>
<pre><code class="lang-ocaml">  <span class="hljs-keyword">let</span> a = f ({ hi = <span class="hljs-keyword">fun</span> [@uncurry] (x,y) -&gt; x + y}[@bs.obj]) <span class="hljs-number">1</span> <span class="hljs-number">2</span> 
  <span class="hljs-keyword">let</span> b = f ({ hi = <span class="hljs-keyword">fun</span> [@uncurry] (x,y) -&gt; x +. y}[@bs.obj]) <span class="hljs-number">1.</span> <span class="hljs-number">2.</span>
</code></pre>
<p>   Generated code is like below </p>
<pre><code class="lang-js">   <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">f</span>(<span class="hljs-params">x, a, b</span>) </span>{
      <span class="hljs-keyword">return</span> x.hi(a, b);
   }

   <span class="hljs-keyword">var</span> a = f({
      <span class="hljs-string">&quot;hi&quot;</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, y</span>) </span>{
       <span class="hljs-keyword">return</span> x + y | <span class="hljs-number">0</span>;
      }
    }, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>);

   <span class="hljs-keyword">var</span> b = f({
     <span class="hljs-string">&quot;hi&quot;</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, y</span>) </span>{
     <span class="hljs-keyword">return</span> x + y;
    }
    }, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
</code></pre>
<p>  <code>bs.obj</code> can also be used in external declarations, like as below:</p>
<pre><code class="lang-OCaml">  <span class="hljs-keyword">external</span> make_config : hi:<span class="hljs-built_in">int</span> -&gt; lo:<span class="hljs-built_in">int</span> -&gt; <span class="hljs-built_in">unit</span> -&gt; t [@@bs.obj]
  <span class="hljs-keyword">let</span> v = make_config ~hi:<span class="hljs-number">2</span> ~lo:<span class="hljs-number">3</span>
</code></pre>
<p>  will be compiled as </p>
<pre><code class="lang-js">  <span class="hljs-keyword">let</span> v = { hi:<span class="hljs-number">2</span>, lo:<span class="hljs-number">3</span>}
</code></pre>
<p>  You can use optional as well</p>
<pre><code class="lang-ocaml">  <span class="hljs-keyword">external</span> make_config : hi:<span class="hljs-built_in">int</span> -&gt; ?lo:<span class="hljs-built_in">int</span> -&gt; <span class="hljs-built_in">unit</span> -&gt; t = <span class="hljs-string">&quot;&quot;</span> [@@bs.obj]
  <span class="hljs-keyword">let</span> u = make_config ~hi:<span class="hljs-number">3</span> <span class="hljs-literal">()</span>
  <span class="hljs-keyword">let</span> v = make_config ~hi:<span class="hljs-number">3</span> ~lo:<span class="hljs-number">2</span> <span class="hljs-literal">()</span>
</code></pre>
<p>  Will generate</p>
<pre><code class="lang-js">  <span class="hljs-keyword">let</span> u = {hi : <span class="hljs-number">3</span>}
  <span class="hljs-keyword">let</span> v = {hi : <span class="hljs-number">3</span> , lo: <span class="hljs-number">2</span>}
</code></pre>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./JS-call-OCaml.html" class="navigation navigation-prev " aria-label="Previous page: JS call OCaml"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./Runtime-representation.html" class="navigation navigation-next " aria-label="Next page: Runtime representation"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

    
    <script src="gitbook/plugins/gitbook-plugin-edit-link/plugin.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"edit-link":{"base":"https://github.com/bloomberg/bucklescript/tree/master/docs","label":"Edit This Page"},"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>


<!DOCTYPE HTML>
<html lang="" >
    <head>
        <title>Compiler overview Â· GitBook</title>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.0">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Home
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Playground
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="Playground.html">
            
                <a href="Playground.html">
            
                    
                    OCaml & Reason Playgrounds
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Get Started
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="Installation.html">
            
                <a href="Installation.html">
            
                    
                    Installation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="Create-a-simple-example-with-NPM.html">
            
                <a href="Create-a-simple-example-with-NPM.html">
            
                    
                    Create a simple example with NPM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="NPM-Support.html">
            
                <a href="NPM-Support.html">
            
                    
                    NPM Support
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    BuckleScript Basics
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="FAQ.html">
            
                <a href="FAQ.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" >
            
                <a target="_blank" href="https://ocaml.org/">
            
                    
                    About OCaml
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="Compiler-options.html">
            
                <a href="Compiler-options.html">
            
                    
                    Compiler options
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="How-to-adapt-your-build-system.html">
            
                <a href="How-to-adapt-your-build-system.html">
            
                    
                    How to adapt your build system
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="Semantic-differences-from-other-backends.html">
            
                <a href="Semantic-differences-from-other-backends.html">
            
                    
                    Semantic differences from other backends
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="JavaScript-target-versions.html">
            
                <a href="JavaScript-target-versions.html">
            
                    
                    JavaScript target versions
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="2.1" >
            
                <span>
            
                    
                    BuckleScript Overview
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="2.1.1" data-path="Compiler-overview.html">
            
                <a href="Compiler-overview.html">
            
                    
                    Compiler overview
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2" >
            
                <span>
            
                    
                    BuckleScript FFI
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" data-path="JS-call-OCaml.html">
            
                <a href="JS-call-OCaml.html">
            
                    
                    JS calling OCaml
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.2" data-path="OCaml-call-JS.html">
            
                <a href="OCaml-call-JS.html">
            
                    
                    OCaml calling JS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.3" data-path="Runtime-representation.html">
            
                <a href="Runtime-representation.html">
            
                    
                    Runtime representation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.4" data-path="Experimental-support-of-typescript.html">
            
                <a href="Experimental-support-of-typescript.html">
            
                    
                    Experimental support of typescript
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.5" data-path="Unsupported-IO-primitives.html">
            
                <a href="Unsupported-IO-primitives.html">
            
                    
                    Unsupported IO primitives
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.3" >
            
                <span>
            
                    
                    Contributions
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.3.1" data-path="Dev-mode-How-to.html">
            
                <a href="Dev-mode-How-to.html">
            
                    
                    Dev mode How to
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.2" data-path="Help-move-runtime-functions-from-OCaml-to-Javascript.md">
            
                <span>
            
                    
                    Help move runtime functions from OCaml to Javascript
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.4" >
            
                <span>
            
                    
                    Roadmap
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.4.1" data-path="Roadmap.html">
            
                <a href="Roadmap.html">
            
                    
                    Roadmap
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.5" >
            
                <span>
            
                    
                    Comparisons
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.5.1" data-path="Differences-from-js_of_ocaml.html">
            
                <a href="Differences-from-js_of_ocaml.html">
            
                    
                    Differences from js_of_ocaml
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Compiler overview</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="high-level-compiler-workflow">High Level compiler workflow</h2><p>The high level architecture is illustrated below:</p><pre><code>Source Language
  |
  | (Reuse OCaml Parser)
  v
Surface Syntax Tree
  |
  | (built in Syntax tree transformation)
  v
Surface Syntax Tree
  |
  | (Reuse OCaml Type checker)
  v
Typedtree
  |
  | (Reuse OCaml pattern match compiler and erase types)
  v
Lambda IR (OCaml compiler libs) ---+
  |   ^                            |                      
  |   |                     Lambda Passes (lam_* files) 
  |   |             Optimization/inlining/dead code elimination
  |   \                            |
  |    \ --------------------------+ 
  |
  |  Self tail call elimination
  |  Constant folding + propagation
  V
JS IR (J.ml)  ---------------------+
  |   ^                            |
  |   |                     JS Passes (js_* files)
  |   |            Optimization/inlining/dead code elimination
  |   \                            |
  |    \  -------------------------+
  |        
  |  Smart printer includes scope analysis 
  |
  V
Javascript Code </code></pre>
<h2 id="design-principles">Design Principles</h2><p>The current design of BuckleScript follows several high level principles. While those principles might change in the future, there are enforced today and can explain certain technical limitations BuckleScript has.</p><p><strong>Lambda Representation</strong></p><p>As pictured in the diagram above, BuckleScript is primarily based on the Lambda representation of the OCaml compiler. While this representation is quite rich, some information is lost from the upstream representation. The patch to the OCaml compiler tries to enrich this representation in a non-intrusive way (see next section).</p><p><strong>Minimal Patch to the OCaml compiler</strong></p><p>BuckleScript requires patches to the OCaml compiler. One of the main reasons is to enrich the Lambda representation so that the generated code is as nice as possible. A design goal is to keep those patches minimal and useful for the OCaml compiler in general so that they can later be integrated.</p><blockquote><p>A common question is to wonder why BuckleScript transpiles an OCaml record value to a JavaScript array while a more intuitive representation would be a JavaScript object. This technical decision is a direct consequence of the above 2 design principles: the Lambda layer assumes in a lot of places that a record value is an array and such modification would be too large of a change to OCaml compiler.</p></blockquote><p><strong>Soundness</strong></p><p>BuckleScript preserves the soundness of the OCaml language. Assuming the FFI is correctly implemented, the type safety is preserved.</p><p><strong>Minimal new symbol creation</strong></p><p>In order to make the JavaScript generated code as close as possible to the original OCaml core we thrive to introduce as few new symbols as possible.</p>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Compiler overview","level":"2.1.1","depth":2,"next":{"title":"BuckleScript FFI","level":"2.2","depth":1,"ref":"","articles":[{"title":"JS calling OCaml","level":"2.2.1","depth":2,"path":"JS-call-OCaml.md","ref":"./JS-call-OCaml.md","articles":[]},{"title":"OCaml calling JS","level":"2.2.2","depth":2,"path":"OCaml-call-JS.md","ref":"./OCaml-call-JS.md","articles":[]},{"title":"Runtime representation","level":"2.2.3","depth":2,"path":"Runtime-representation.md","ref":"./Runtime-representation.md","articles":[]},{"title":"Experimental support of typescript","level":"2.2.4","depth":2,"path":"Experimental-support-of-typescript.md","ref":"./Experimental-support-of-typescript.md","articles":[]},{"title":"Unsupported IO primitives","level":"2.2.5","depth":2,"path":"Unsupported-IO-primitives.md","ref":"./Unsupported-IO-primitives.md","articles":[]}]},"previous":{"title":"BuckleScript Overview","level":"2.1","depth":1,"ref":"","articles":[{"title":"Compiler overview","level":"2.1.1","depth":2,"path":"Compiler-overview.md","ref":"./Compiler-overview.md","articles":[]}]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["edit-link@2.0.2"],"pluginsConfig":{"edit-link":{"label":"Edit This Page","base":"https://github.com/bloomberg/bucklescript/tree/master/docs"},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"Compiler-overview.md","mtime":"2016-08-04T18:21:25.000Z","type":"markdown"},"gitbook":{"version":"3.2.0","time":"2016-08-07T23:58:07.032Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

